<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora de Circuitos Elétricos</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0d6efd">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-color: #0d6efd;
      --primary-hover-color: #0b5ed7;
      --success-color: #198754;
      --light-gray: #f8f9fa;
      --medium-gray: #e9ecef;
      --border-color: #dee2e6;
      --dark-text: #212529;
      --light-text: #6c757d;
    }
    
    * { box-sizing: border-box; }

    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: var(--medium-gray);
      color: var(--dark-text);
    }

    #app {
      max-width: 800px;
      margin: 30px auto;
      padding: 30px;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      color: var(--dark-text);
      font-weight: 800;
      font-size: 2.2em;
      letter-spacing: -1px;
      margin-top: 0;
    }
    
    h2 {
      text-align: center;
      color: var(--primary-color);
      font-weight: 700;
      font-size: 1.8em;
      border-bottom: 2px solid var(--medium-gray);
      padding-bottom: 15px;
      margin-bottom: 25px;
    }

    .tabs {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      margin-bottom: 25px;
    }
    .tab-link {
      background-color: transparent;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 20px;
      font-size: 1.1em;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      color: var(--light-text);
      border-bottom: 3px solid transparent;
      transition: color 0.2s, border-color 0.2s;
    }
    .tab-link:hover {
      color: var(--primary-color);
    }
    .tab-link.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .tab-explanation {
        background-color: var(--light-gray);
        padding: 15px;
        margin-bottom: 25px;
        border-radius: 8px;
        border-left: 4px solid var(--primary-color);
        font-size: 0.9em;
        line-height: 1.6;
    }
    
    .form-section {
      padding: 25px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
    }
    .form-group { margin-bottom: 20px; }
    .form-group:last-child { margin-bottom: 0; }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 0.9em;
      color: var(--light-text);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .form-group input[type="number"], .form-group input[type="text"], .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--border-color);
      border-radius: 6px;
      font-size: 1em;
      font-family: 'Inter', sans-serif;
    }
    .form-group input:focus, .form-group select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
    }
    .input-group { display: flex; gap: 15px; align-items: flex-end; }
    .input-group > div { flex: 1; }
    .radio-group-power { display: flex; align-items: center; gap: 15px; padding-bottom: 12px; padding-left: 5px; }
    .radio-group-power label { margin-bottom: 0; font-weight: normal; text-transform: none; color: var(--dark-text); }
    .radio-group-power input[type="radio"] { margin-right: 5px; transform: scale(1.1); }
    .radio-group-horizontal {
        display: flex;
        justify-content: flex-start;
        gap: 30px;
        align-items: center;
        background-color: var(--light-gray);
        padding: 15px;
        border-radius: 6px;
    }
    .radio-group-horizontal label {
        font-weight: 600;
        font-size: 1em;
        margin-left: 8px;
        cursor: pointer;
        color: var(--dark-text);
        text-transform: none;
        letter-spacing: 0;
    }
    .radio-group-horizontal div {
        display: flex;
        align-items: center;
    }
    .radio-group-horizontal input[type="radio"] {
        transform: scale(1.2);
    }
    .calculate-btn {
      width: 100%;
      padding: 15px;
      font-size: 1.2em;
      font-weight: 700;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #results-panel {
      margin-top: 30px;
      padding: 25px;
      background-color: var(--light-gray);
      border-radius: 8px;
      display: none;
    }
    .result-item-label { font-weight: 600; color: var(--light-text); text-transform: uppercase; font-size: 0.9em; }
    .result-item-value { font-size: 3em; font-weight: 800; line-height: 1.1; }
    .result-item-value.breaker { color: var(--primary-color); }
    .result-item-value.cable { color: var(--success-color); }
    .justification { font-style: italic; text-align: center; margin: 25px auto; }
    #context-table { width: 100%; border-collapse: collapse; }
    #context-table th, #context-table td { border: 1px solid var(--border-color); padding: 12px; text-align: center; }
    #context-table th { background-color: #e9ecef; }
    #context-table .recommended-row { background-color: #d1e7dd; font-weight: 700; }

    @media (max-width: 768px) {
      body { padding: 10px; }
      #app { padding: 15px; margin: 10px auto; }
      .form-group input[type="number"], .form-group input[type="text"], .form-group select, .calculate-btn { font-size: 16px; }
      .input-group { flex-direction: column; gap: 20px; align-items: stretch; }
      .radio-group-horizontal { flex-direction: column; align-items: flex-start; gap: 15px; }
    }
  </style>
</head>
<body>

  <div id="app">
    <h1>Calculadora de Circuitos Elétricos</h1>

    <div class="tabs">
      <button class="tab-link active" onclick="openTab(event, 'Geral')">Geral</button>
      <button class="tab-link" onclick="openTab(event, 'Profissional')">Profissional</button>
    </div>

    <div id="Geral" class="tab-content">
      <div class="tab-explanation">
        <strong>Uso Ideal:</strong> Para dimensionar rapidamente o cabo e disjuntor para um <strong>único equipamento</strong> ligado a um circuito existente e seguro.
      </div>
      <form id="form-geral" onsubmit="return false;">
        <div class="form-section">
          <div class="form-group">
              <label>Modo de Cálculo</label>
              <div class="radio-group-horizontal">
                  <div>
                      <input type="radio" id="by-power-geral" name="load_type_geral" value="power" checked>
                      <label for="by-power-geral">Por Potência</label>
                  </div>
                  <div>
                      <input type="radio" id="by-current-geral" name="load_type_geral" value="current">
                      <label for="by-current-geral">Por Corrente</label>
                  </div>
              </div>
          </div>

          <div id="power-inputs-geral">
            <div class="form-group">
              <label for="power-geral">Potência do Equipamento</label>
               <div class="input-group">
                <input type="number" id="power-geral" placeholder="Ex: 2000" step="any">
                <div class="radio-group-power">
                    <input type="radio" id="unit-w-geral" name="power_unit_geral" value="W" checked>
                    <label for="unit-w-geral">W</label>
                    <input type="radio" id="unit-kw-geral" name="power_unit_geral" value="kW">
                    <label for="unit-kw-geral">kW</label>
                </div>
              </div>
            </div>
          </div>

          <div id="current-inputs-geral" style="display: none;">
            <div class="form-group">
              <label for="current-geral">Corrente do Equipamento (A)</label>
              <input type="text" id="current-geral" placeholder="Ex: 15.7">
            </div>
          </div>
          <div class="form-group input-group">
            <div>
              <label for="voltage-geral">Tensão (V)</label>
              <select id="voltage-geral">
                <option value="127">127 V</option>
                <option value="220">220 V</option>
                <option value="380">380 V</option>
              </select>
            </div>
            <div>
              <label for="circuit-type-geral">Tipo de Circuito</label>
              <select id="circuit-type-geral">
                <option value="mono">Monofásico</option>
                <option value="tri">Trifásico</option>
              </select>
            </div>
          </div>
          <div class="form-group">
              <label for="length-geral">Comprimento do Cabo (m)</label>
              <input type="text" id="length-geral" placeholder="Ex: 3">
          </div>
        </div>
        <button type="button" id="calculate-btn-geral" class="calculate-btn">Calcular</button>
      </form>
    </div>

    <div id="Profissional" class="tab-content">
       <div class="tab-explanation">
        <strong>Uso Ideal:</strong> Para projetar um <strong>circuito elétrico completo</strong> desde o quadro de distribuição.
      </div>
      <form id="form-pro" onsubmit="return false;">
          <div class="form-section">
            <div class="form-group">
                <label>Modo de Cálculo</label>
                <div class="radio-group-horizontal">
                    <div>
                        <input type="radio" id="by-power-pro" name="load_type_pro" value="power" checked>
                        <label for="by-power-pro">Calcular pela Potência</label>
                    </div>
                    <div>
                        <input type="radio" id="by-current-pro" name="load_type_pro" value="current">
                        <label for="by-current-pro">Calcular com a Corrente</label>
                    </div>
                </div>
            </div>

            <div id="power-inputs-pro">
              <div class="form-group">
                <label for="power-pro">Potência Total</label>
                <div class="input-group">
                  <input type="number" id="power-pro" placeholder="Ex: 5 ou 5000" step="any">
                  <div class="radio-group-power">
                    <input type="radio" id="unit-w-pro" name="power_unit_pro" value="W" checked>
                    <label for="unit-w-pro">W</label>
                    <input type="radio" id="unit-kw-pro" name="power_unit_pro" value="kW">
                    <label for="unit-kw-pro">kW</label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="power-factor-pro">Fator de Potência (cos φ)</label>
                <select id="power-factor-pro">
                    <option value="" disabled selected>Selecione o tipo de carga...</option>
                    <optgroup label="Cargas Resistivas">
                      <option value="1.00">1.00 - Aquecedores, Chuveiros, Lâmpadas Incandescentes</option>
                    </optgroup>
                    <optgroup label="Iluminação">
                      <option value="0.98">0.98 - Lâmpadas Fluorescentes (reator eletrônico)</option>
                      <option value="0.95">0.95 - Lâmpadas de LED (boa qualidade)</option>
                      <option value="0.70">0.70 - Lâmpadas Fluorescentes (reator magnético)</option>
                    </optgroup>
                    <optgroup label="Motores de Indução">
                       <option value="0.92">0.92 - Padrão Geral / Cargas Mistas</option>
                       <option value="0.85">0.85 - Motor em Plena Carga</option>
                       <option value="0.75">0.75 - Motor com 75% de Carga</option>
                       <option value="0.65">0.65 - Motor com 50% de Carga</option>
                    </optgroup>
                     <optgroup label="Equipamentos Eletrônicos">
                      <option value="0.95">0.95 - Fontes com PFC Ativo (PCs, TVs modernas)</option>
                      <option value="0.60">0.60 - Fontes Chaveadas Simples (antigas)</option>
                    </optgroup>
                </select>
              </div>
            </div>

            <div id="current-inputs-pro" style="display: none;">
              <div class="form-group">
                <label for="current-pro">Corrente de Projeto (A)</label>
                <input type="text" id="current-pro" placeholder="Ex: 22.7">
              </div>
            </div>
          </div>
          <div class="form-section">
            <div class="form-group input-group">
              <div>
                <label for="voltage-pro">Tensão (V)</label>
                <select id="voltage-pro">
                  <option value="127">127 V</option>
                  <option value="220">220 V</option>
                  <option value="380">380 V</option>
                </select>
              </div>
              <div>
                <label for="circuit-type-pro">Tipo de Circuito</label>
                <select id="circuit-type-pro">
                  <option value="mono">Monofásico</option>
                  <option value="tri">Trifásico</option>
                </select>
              </div>
            </div>
            <div class="form-group">
                <label for="length-pro">Comprimento do Cabo (m)</label>
                <input type="text" id="length-pro" placeholder="Ex: 25">
            </div>
          </div>
          <div class="form-section">
            <div class="form-group">
              <label for="install-method-pro">Método de Instalação (NBR 5410)</label>
              <select id="install-method-pro">
                <option value="A2">A2 - Cabo sobre parede/isoladores</option>
                <option value="B1" selected>B1 - Eletroduto embutido em alvenaria</option>
                <option value="B2">B2 - Eletroduto aparente (superfície)</option>
                <option value="C">C - Eletrocalha ou bandeja perfurada</option>
              </select>
            </div>
            <div class="form-group input-group">
                <div>
                    <label for="temperature-pro">Temperatura Ambiente</label>
                    <select id="temperature-pro">
                        <option value="30">30°C (Padrão)</option>
                        <option value="25">25°C</option>
                        <option value="35">35°C</option>
                        <option value="40">40°C</option>
                        <option value="45">45°C</option>
                    </select>
                </div>
                <div>
                    <label for="grouping-pro">Circuitos Agrupados</label>
                    <select id="grouping-pro">
                        <option value="1">1 (Nenhum)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>
            </div>
          </div>
          <button type="button" id="calculate-btn-pro" class="calculate-btn">Calcular</button>
      </form>
    </div>

    <div id="results-panel">
        <h2>Resultado do Dimensionamento</h2>
        <div style="display: flex; justify-content: space-around; text-align: center;">
            <div class="result-item">
                <div class="result-item-label">Disjuntor Recomendado</div>
                <div id="breaker-result" class="result-item-value breaker"></div>
            </div>
            <div class="result-item">
                <div class="result-item-label">Seção do Cabo Recomendada</div>
                <div id="cable-result" class="result-item-value cable"></div>
            </div>
        </div>
        <p id="justification" class="justification"></p>
        <table id="context-table">
            <thead>
                <tr>
                    <th>Seção (mm²)</th>
                    <th>Capacidade (Iz)*</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="context-table-body"></tbody>
        </table>
        <small id="results-footer" style="text-align: center; display: block; margin-top: 10px;"></small>
    </div>
  </div>
  
  <script>
    // --- LÓGICA DAS ABAS ---
    function openTab(evt, tabName) {
      let i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tab-content");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tab-link");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
      document.getElementById('results-panel').style.display = 'none';
    }
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelector('.tab-link').click();
    });

    // --- MOTOR DE CÁLCULO E DADOS ---
    const commercialCables = [1.5, 2.5, 4, 6, 10, 16, 25, 35, 50, 70];
    const commercialBreakers = [10, 16, 20, 25, 32, 40, 50, 63, 70];
    const cableCapacityTable = {
      'A2': { '1.5': 21, '2.5': 28, '4': 37, '6': 48, '10': 68, '16': 92 },
      'B1': { '1.5': 17.5, '2.5': 24, '4': 32, '6': 41, '10': 57, '16': 76 },
      'B2': { '1.5': 19.5, '2.5': 27, '4': 36, '6': 46, '10': 64, '16': 85 },
      'C':  { '1.5': 22, '2.5': 30, '4': 40, '6': 52, '10': 73, '16': 98 }
    };
    const tempCorrectionFactors = { '25': 1.05, '30': 1.00, '35': 0.94, '40': 0.87, '45': 0.79 };
    const groupingCorrectionFactors = { '1': 1.00, '2': 0.80, '3': 0.70, '4': 0.65, '5': 0.60 };
    
    function performCalculation(params) {
        let { power, pf, current, length, voltage, circuitType, installMethod, temperature, groupedCircuits } = params;
        if (isNaN(length) || length <= 0) { alert("Por favor, insira um comprimento de cabo válido."); return; }
        let designCurrent;
        if (power !== undefined) {
          if (isNaN(power) || power <= 0 || isNaN(pf) || pf <= 0) { alert("Por favor, preencha Potência e selecione um Fator de Potência válido."); return; }
          designCurrent = (circuitType === 'mono') ? (power / (voltage * pf)) : (power / (voltage * pf * Math.sqrt(3)));
        } else {
          if (isNaN(current) || current <= 0) { alert("Por favor, insira uma corrente válida."); return; }
          designCurrent = current;
        }
        let recommendedBreaker = commercialBreakers.find(b => b >= designCurrent);
        if (!recommendedBreaker) { alert("Nenhuma opção de disjuntor suporta a corrente de projeto."); return; }
        const fct = tempCorrectionFactors[temperature.toString()] || 1.0;
        const fca = groupingCorrectionFactors[groupedCircuits.toString()] || 1.0;
        let cableForBreaker = commercialCables.find(size => {
            const baseCapacity = cableCapacityTable[installMethod]?.[size.toString()];
            return baseCapacity && (baseCapacity * fct * fca) >= recommendedBreaker;
        });
        if (!cableForBreaker) { alert(`Nenhum cabo suporta a corrente do disjuntor de ${recommendedBreaker}A com os fatores de correção aplicados.`); return; }
        const MAX_VOLTAGE_DROP = 4;
        const COPPER_RESISTIVITY = 0.0178;
        let cableForVoltageDrop = null;
        let finalVoltageDrop = 0;
        for (const size of commercialCables) {
            let voltageDrop = (circuitType === 'mono') ? (200 * COPPER_RESISTIVITY * length * designCurrent) / (size * voltage) : (173.2 * COPPER_RESISTIVITY * length * designCurrent) / (size * voltage);
            if (voltageDrop <= MAX_VOLTAGE_DROP) {
                cableForVoltageDrop = size;
                const finalCableCheckSize = Math.max(cableForBreaker, cableForVoltageDrop);
                finalVoltageDrop = (circuitType === 'mono') ? (200 * COPPER_RESISTIVITY * length * designCurrent) / (finalCableCheckSize * voltage) : (173.2 * COPPER_RESISTIVITY * length * designCurrent) / (finalCableCheckSize * voltage);
                break;
            }
        }
        if (!cableForVoltageDrop) { alert("Nenhum cabo atende ao critério de queda de tensão."); return; }
        const finalCableSize = Math.max(cableForBreaker, cableForVoltageDrop);
        const baseFinalCapacity = cableCapacityTable[installMethod][finalCableSize.toString()];
        const finalCableCapacity = baseFinalCapacity * fct * fca;
        document.getElementById('breaker-result').textContent = `${recommendedBreaker} A`;
        document.getElementById('cable-result').textContent = `${finalCableSize} mm²`;
        let justificationText = `Justificativa: Corrente de projeto de ${designCurrent.toFixed(2)}A e queda de tensão de ${finalVoltageDrop.toFixed(2)}%. O disjuntor de ${recommendedBreaker}A protege o circuito (In ≥ Ib). O cabo de ${finalCableSize}mm² tem capacidade de ${finalCableCapacity.toFixed(2)}A nestas condições (Iz corrigida), sendo protegido pelo disjuntor (In ≤ Iz).`;
        if (fct !== 1.0 || fca !== 1.0) { justificationText += ` Fatores de Correção aplicados: Temp=${fct}, Agrup=${fca}.` }
        document.getElementById('justification').textContent = justificationText;
        const tableBody = document.getElementById('context-table-body');
        tableBody.innerHTML = '';
        const installMethodDescription = document.querySelector(`#install-method-pro option[value="${installMethod}"]`)?.textContent || "Padrão (Ar Livre)";
        document.getElementById('results-footer').textContent = `*Capacidade de corrente (Iz) corrigida para ${temperature}°C, ${groupedCircuits} circuito(s) agrupado(s) e método ${installMethod}.`;
        commercialCables.forEach(size => {
            const baseCapacity = cableCapacityTable[installMethod]?.[size.toString()];
            const correctedCapacity = baseCapacity ? (baseCapacity * fct * fca).toFixed(2) : 'N/A';
            const row = document.createElement('tr');
            if (size === finalCableSize) { row.classList.add('recommended-row'); }
            row.innerHTML = `<td>${size} mm²</td><td>${correctedCapacity} A</td><td>${size === finalCableSize ? '✅' : ''}</td>`;
            tableBody.appendChild(row);
        });
        document.getElementById('results-panel').style.display = 'block';
    }

    // --- EVENT LISTENERS PARA OS BOTÕES ---
    const getNumericValueFromText = (elementId) => {
        const el = document.getElementById(elementId);
        if (!el || !el.value) return NaN;
        return parseFloat(el.value.replace(',', '.'));
    };

    // ** INÍCIO DA ALTERAÇÃO NO JAVASCRIPT **
    const loadTypeRadiosGeral = document.querySelectorAll('input[name="load_type_geral"]');
    const powerInputsGeral = document.getElementById('power-inputs-geral');
    const currentInputsGeral = document.getElementById('current-inputs-geral');
    loadTypeRadiosGeral.forEach(radio => {
        radio.addEventListener('change', (e) => {
            if (e.target.value === 'power') {
                powerInputsGeral.style.display = 'block';
                currentInputsGeral.style.display = 'none';
            } else {
                powerInputsGeral.style.display = 'none';
                currentInputsGeral.style.display = 'block';
            }
        });
    });

    document.getElementById('calculate-btn-geral').addEventListener('click', () => {
        const loadType = document.querySelector('input[name="load_type_geral"]:checked').value;
        const params = {
            voltage: parseInt(document.getElementById('voltage-geral').value),
            circuitType: document.getElementById('circuit-type-geral').value,
            length: getNumericValueFromText('length-geral'),
            installMethod: 'A2',
            temperature: 30,
            groupedCircuits: 1,
            pf: 0.92, 
        };
        if (loadType === 'power') {
            let power = getNumericValueFromText('power-geral');
            const powerUnit = document.querySelector('input[name="power_unit_geral"]:checked').value;
            if (powerUnit === 'kW') { power *= 1000; }
            params.power = power;
        } else {
            params.current = getNumericValueFromText('current-geral');
        }
        performCalculation(params);
    });

    const loadTypeRadiosPro = document.querySelectorAll('input[name="load_type_pro"]');
    const powerInputsPro = document.getElementById('power-inputs-pro');
    const currentInputsPro = document.getElementById('current-inputs-pro');
    loadTypeRadiosPro.forEach(radio => {
        radio.addEventListener('change', (e) => {
            if (e.target.value === 'power') {
                powerInputsPro.style.display = 'block';
                currentInputsPro.style.display = 'none';
            } else {
                powerInputsPro.style.display = 'none';
                currentInputsPro.style.display = 'block';
            }
        });
    });

    document.getElementById('calculate-btn-pro').addEventListener('click', () => {
        const loadType = document.querySelector('input[name="load_type_pro"]:checked').value;
        const params = {
            voltage: parseInt(document.getElementById('voltage-pro').value),
            circuitType: document.getElementById('circuit-type-pro').value,
            length: getNumericValueFromText('length-pro'),
            installMethod: document.getElementById('install-method-pro').value,
            temperature: parseInt(document.getElementById('temperature-pro').value),
            groupedCircuits: parseInt(document.getElementById('grouping-pro').value)
        };
        if (loadType === 'power') {
            let power = getNumericValueFromText('power-pro');
            const powerUnit = document.querySelector('input[name="power_unit_pro"]:checked').value;
            if (powerUnit === 'kW') { power *= 1000; }
            params.power = power;
            params.pf = parseFloat(document.getElementById('power-factor-pro').value);
        } else {
            params.current = getNumericValueFromText('current-pro');
        }
        performCalculation(params);
    });
     // ** FIM DA ALTERAÇÃO NO JAVASCRIPT **
  </script>
</body>
</html>
