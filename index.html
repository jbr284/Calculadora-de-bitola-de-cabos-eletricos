<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CalcEl√©trica Pro</title>
  
  <link rel="icon" type="image/png" href="icons/icon-192x192.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0d6efd">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div id="print-header" style="display:none;">
    <h1>Relat√≥rio de Dimensionamento El√©trico</h1>
    <p>Data: <span id="print-date"></span></p>
    <hr>
  </div>

  <div id="app">
    <h1 class="screen-only">Calculadora El√©trica Pro</h1>

    <div class="tabs screen-only">
      <button class="tab-link" data-tab="Geral">Dimensionamento R√°pido</button>
      <button class="tab-link" data-tab="Profissional">Profissional / Industrial</button>
    </div>

    <div id="Geral" class="tab-content">
      <div class="tab-explanation">
        <strong>Modo R√°pido:</strong> Dimensionamento √°gil para equipamentos (Fornos, Motores, Chuveiros). Padr√£o: Cabo PVC em Alvenaria (B1).
      </div>
      <form id="form-geral">
        <div class="form-section">
          
          <div class="form-group">
            <label for="power-geral">Pot√™ncia do Equipamento</label>
            <div class="input-group">
                <div style="flex: 2;">
                    <input type="number" id="power-geral" placeholder="Ex: 18000 ou 18">
                </div>
                <div style="flex: 1;">
                    <select id="power-unit-geral">
                        <option value="W" selected>Watts (W)</option>
                        <option value="kW">Quilowatts (kW)</option>
                    </select>
                </div>
            </div>
          </div>

          <div class="form-group input-group">
            <div>
              <label for="voltage-geral">Tens√£o (V)</label>
              <select id="voltage-geral">
                <option value="127">127 V</option> 
                <option value="220" selected>220 V</option>
                <option value="380">380 V</option>
                <option value="440">440 V</option>
              </select>
            </div>
            <div>
              <label for="phases-geral">Fases</label>
              <select id="phases-geral">
                <option value="mono">Mono/Bif√°sico</option> 
                <option value="tri">Trif√°sico</option>
              </select>
            </div>
          </div>

          <div class="form-group">
              <label for="length-geral">Dist√¢ncia (m)</label>
              <input type="number" id="length-geral" placeholder="Ex: 15">
          </div>

        </div>
        <div class="button-group">
            <button type="button" id="calculate-btn-geral" class="calculate-btn">CALCULAR R√ÅPIDO</button>
        </div>
      </form>
    </div>

    <div id="Profissional" class="tab-content">
       <div class="tab-explanation">
        <strong>Modo Projeto:</strong> Controle total sobre fatores de corre√ß√£o, tipo de isola√ß√£o (PVC/HEPR), agrupamento e temperatura.
      </div>
      <form id="form-pro">
          <div class="form-section">
            <h3>1. Carga El√©trica</h3>
            <div class="form-group input-group">
               <div style="flex: 2;">
                 <label for="power-pro">Pot√™ncia (Watts)</label>
                 <input type="number" id="power-pro" placeholder="Ex: 7500" class="save-state">
               </div>
               <div style="flex: 1;">
                 <label for="power-factor-pro">Fator de Pot√™ncia</label>
                 <select id="power-factor-pro" class="save-state">
                    <option value="1.00">1.00 (Resistivo)</option>
                    <option value="0.92">0.92 (Misto/Padr√£o)</option>
                    <option value="0.85">0.85 (Motor)</option>
                    <option value="0.80">0.80 (Baixo)</option>
                 </select>
               </div>
            </div>
          </div>

          <div class="form-section">
            <h3>2. Dados da Rede</h3>
            <div class="form-group input-group">
              <div>
                <label for="voltage-pro">Tens√£o (V)</label>
                <select id="voltage-pro" class="save-state">
                  <option value="127">127 V</option> <option value="220" selected>220 V</option> <option value="380">380 V</option>
                </select>
              </div>
              <div>
                <label for="circuit-type-pro">Fases</label>
                <select id="circuit-type-pro" class="save-state">
                  <option value="mono">Monof√°sico (F+N)</option> <option value="bifasico">Bif√°sico (F+F)</option> <option value="tri">Trif√°sico (3F)</option>
                </select>
              </div>
            </div>
            <div id="voltage-warning" class="warning-box" style="display:none;">‚ö†Ô∏è Aten√ß√£o: Redes trif√°sicas de 127V s√£o raras. Verifique se n√£o √© 220V.</div>
            
            <div class="form-group">
                <label for="length-pro">Comprimento do Circuito (metros)</label>
                <input type="number" id="length-pro" placeholder="Ex: 45" class="save-state">
            </div>
          </div>

          <div class="form-section">
            <h3>3. M√©todo e Material</h3>
            <div class="form-group input-group">
                <div>
                    <label>Condutor</label>
                    <select id="conductor-material-pro" class="save-state">
                        <option value="cobre">Cobre</option> <option value="aluminio">Alum√≠nio</option>
                    </select>
                </div>
                <div>
                    <label>Isola√ß√£o <span class="tooltip" title="PVC: Residencial (70¬∞C). HEPR: Industrial (90¬∞C)">[?]</span></label>
                    <select id="insulation-pro" class="save-state">
                        <option value="PVC">PVC (70¬∞C)</option> <option value="HEPR">HEPR/XLPE (90¬∞C)</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
              <label for="install-method-pro">M√©todo de Instala√ß√£o (NBR 5410)</label>
              <select id="install-method-pro" class="save-state">
                <option value="B1" selected>B1 - Eletroduto em Alvenaria (Padr√£o)</option>
                <option value="B2">B2 - Eletroduto Aparente</option>
                <option value="C">C - Diretamente na parede/Eletrocalha</option>
                <option value="A2">A2 - Cabo isolado em parede isolante</option>
              </select>
            </div>
            
            <div class="form-group input-group">
                <div>
                    <label>Temp. Ambiente</label>
                    <select id="temperature-pro" class="save-state">
                        <option value="30">30¬∞C</option> <option value="35">35¬∞C</option> <option value="40">40¬∞C</option> <option value="45">45¬∞C</option>
                    </select>
                </div>
                <div>
                    <label>Agrupamento</label>
                    <select id="grouping-pro" class="save-state">
                        <option value="1">1 Circuito</option> <option value="2">2 Circuitos</option> <option value="3" selected>3 Circuitos</option>
                        <option value="4">4 Circuitos</option> <option value="5">5 Circuitos</option>
                    </select>
                </div>
            </div>
          </div>

          <div class="button-group screen-only">
            <button type="button" id="calculate-btn-pro" class="calculate-btn">CALCULAR PROJETO</button>
            <button type="button" id="reset-btn-pro" class="reset-btn">Limpar</button>
          </div>
      </form>
    </div>

    <div id="error-panel" class="error-panel"></div>

    <div id="results-panel">
        <div class="results-header">
            <h2>Resultado do Dimensionamento</h2>
            <button id="btn-print" class="screen-only btn-small">üìÑ Gerar Relat√≥rio PDF</button>
        </div>
        
        <div class="summary-box">
            <div class="result-item">
                <div class="result-item-label">Disjuntor Recomendado</div>
                <div id="breaker-result" class="result-item-value breaker">--</div>
            </div>
            <div class="result-item">
                <div class="result-item-label">Cabo (Se√ß√£o M√≠nima)</div>
                <div id="cable-result" class="result-item-value cable">--</div>
            </div>
        </div>

        <div class="tech-details">
            <h3>Memorial de C√°lculo</h3>
            <ul id="calculation-log"></ul>
        </div>

        <h3>An√°lise de Capacidade (Crit√©rio de Corrente)</h3>
        <table id="context-table">
            <thead><tr><th>Se√ß√£o (mm¬≤)</th><th>Capacidade Real (Iz)</th><th>Status</th></tr></thead>
            <tbody id="context-table-body"></tbody>
        </table>
        
        <div class="footer-note">
            *C√°lculo conforme NBR 5410. A responsabilidade final √© do engenheiro/projetista.
        </div>
    </div>
  </div>
  
  <script src="dados.js"></script>
  <script src="script.js"></script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').then(reg => {
        reg.addEventListener('updatefound', () => {
          const newWorker = reg.installing;
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
               window.location.reload();
            }
          });
        });
      });
      let refreshing;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return;
        window.location.reload();
        refreshing = true;
      });
    }
  </script>
</body>
</html>
